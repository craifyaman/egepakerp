@using EgepakErp.DtModels;

@model List<MaliyetDto>
@{
    var liste = Model.GroupBy(x => x.KalipId);
    double ToplamTutar = 0;
    decimal DolarKur = ViewBag.dolarKur;
    decimal EuroKur = ViewBag.euroKur;
}

<tr class="sum">
    <td>
        <table>
            <tr>
                <td width="75%" style="border:none;">
                    Genel giderli Toplam Maliyet
                    <input type="text" class="form-control" value="1" disabled />
                </td>
            </tr>
        </table>
    </td>

    @foreach (var item in liste)
    {
        <td>
            <div class="form-group row">
                <div class="col-lg-12 mb-2" style="position: relative; top: 25px;">
                    @item.Where(x => x.Status == true).Sum(x => x.Tutar).ToString("n2") ₺
                    @{ ToplamTutar += item.Sum(x => x.Tutar);}
                </div>
            </div>
        </td>
    }

</tr>

<tr class="sum">
    <td>
        <table>
            <tr>
                <td width="75%" style="border:none;">
                    Nakit Satış Fiyatı
                    <input type="text" class="form-control" value="1,25" disabled />
                </td>
            </tr>
        </table>
    </td>
    @foreach (var item in liste)
    {
        <td>
            <div class="form-group row">
                <div class="col-lg-12 mb-2" style="position: relative; top: 25px;">
                    @{ var NakitFiyat = item.Where(x => x.Status == true).Sum(x => x.Tutar) * (1.25);}
                    @NakitFiyat.ToString("n2") ₺
                </div>
            </div>
        </td>
    }

</tr>
<tr class="sum">
    <td>
        <table>
            <tr>
                <td width="75%" style="border:none;">
                    Vadeli Satış
                    <input type="text" class="form-control" value="1,4" disabled />
                </td>

            </tr>
        </table>
    </td>
    @foreach (var item in liste)
    {
        <td>
            <div class="form-group row">
                <div class="col-lg-12 mb-2" style="position: relative; top: 25px;">
                    @{ var VadeliFiyat = item.Where(x => x.Status == true).Sum(x => x.Tutar) * (1.25*1.4);}
                    @VadeliFiyat.ToString("n2") ₺
                </div>
            </div>
        </td>
    }

</tr>

<tr class="sum">
    <th>Teklif Tutar Tl</th>
    <th style="position: absolute; width: 80%; font-size: 15px; text-align:center;">
        <span id="TeklifTutari">
            @ToplamTutar.ToString("n2")
        </span>
    ₺</th>
</tr>

@if (DolarKur != 0 || EuroKur != 0)
{
    <tr class="sum">
        <th>Teklif Tutar USD</th>
        @{
            var DolarFiyat = (decimal)ToplamTutar / DolarKur;
        }
        <th style="position: absolute; width: 80%; font-size: 15px; text-align:center;"> <span id="usdKurSonuc">@DolarFiyat.ToString("n2") </span> $ <span style="font-size: 13px;"> (USD/TL @DolarKur) </span></th>
    </tr>

    <tr class="sum">
        <th>Teklif Tutar EUR</th>
        @{
            var EuroFiyat = (decimal)ToplamTutar / EuroKur;
        }
        <th style="position: absolute; width: 80%; font-size: 15px; text-align:center;"><span id="eurKurSonuc">@EuroFiyat.ToString("n2")</span>€ <span style="font-size: 13px;">(EUR/TL @EuroKur)</span></th>
    </tr>
}

